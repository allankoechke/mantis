<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mantis App: Mantis Sync Engine Design (NOT IMPLEMENTED YET!)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mantis.png"/></td>
  <td id="projectalign">
   <div id="projectname">Mantis App<span id="projectnumber">&#160;v0.1.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Mantis Sync Engine Design (NOT IMPLEMENTED YET!)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md96"></a> The Mantis sync engine is designed to support offline-first applications that require robust and efficient synchronization between local nodes (clients) and remote nodes (servers). This document outlines how the sync system works, how it is configured, and how conflicts are handled.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md98"></a>
üîÑ Sync Model Overview</h1>
<p>Mantis supports a <b>two-mode sync model</b>:</p><ul>
<li><b>Client Mode</b>: Local-first apps that store data offline and push/pull to a remote sync server.</li>
<li><b>Server Mode</b>: Central node that aggregates data, applies sync policies, and serves updates.</li>
</ul>
<p>Both modes are configured via the startup configuration file.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md100"></a>
‚öôÔ∏è Sync Workflow</h1>
<div class="fragment"><div class="line">+-------------+       Push       +-------------+</div>
<div class="line">|  Client DB  | ---------------&gt; |  Server DB  |</div>
<div class="line">| (SQLite)    |                 | (MySQL)     |</div>
<div class="line">+-------------+                 +-------------+</div>
<div class="line">       ^                             |</div>
<div class="line">       |         Pull/Update         |</div>
<div class="line">       +-----------------------------+</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md101"></a>
1. &lt;strong&gt;Change Detection&lt;/strong&gt;</h2>
<ul>
<li>Each table has an internal <code>__updated_at</code> timestamp or revision ID.</li>
<li>Sync engine scans for new/changed rows since the last sync.</li>
</ul>
<h2><a class="anchor" id="autotoc_md102"></a>
2. &lt;strong&gt;Conflict Resolution&lt;/strong&gt;</h2>
<ul>
<li>Defaults to <b>latest timestamp wins</b>.</li>
<li>Optional: version-based merge or manual conflict hooks.</li>
</ul>
<h2><a class="anchor" id="autotoc_md103"></a>
3. &lt;strong&gt;Transport Layer&lt;/strong&gt;</h2>
<ul>
<li>REST API or WebSocket-based sync messages.</li>
<li>All data is serialized as JSON.</li>
<li>Sync headers include node ID, table revision, and auth token.</li>
</ul>
<h2><a class="anchor" id="autotoc_md104"></a>
4. &lt;strong&gt;Sync Tables&lt;/strong&gt;</h2>
<ul>
<li><code>__sync_log</code>: Stores outgoing sync queue</li>
<li><code>__sync_state</code>: Tracks last pull/push per table and remote</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md106"></a>
üîê Security</h1>
<ul>
<li>All sync endpoints require authentication (JWT or session).</li>
<li>Encrypted transport via HTTPS or TLS WebSocket.</li>
<li>Sync can be enabled/disabled per client in config.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md108"></a>
üß™ Sync Testing</h1>
<p>Simulate sync with curl:</p>
<div class="fragment"><div class="line">curl -X POST http://localhost:8080/sync/push   -H &quot;Authorization: Bearer &lt;token&gt;&quot;   -d @sync_payload.json</div>
</div><!-- fragment --><p>Use <code>mantisd --mode server</code> on one node and <code>mantisd --mode client</code> on another to test full duplex sync.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md110"></a>
üîß Configuration Example</h1>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;mode&quot;: &quot;client&quot;,</div>
<div class="line">  &quot;sync&quot;: {</div>
<div class="line">    &quot;enabled&quot;: true,</div>
<div class="line">    &quot;server_url&quot;: &quot;https://api.mantis.io&quot;,</div>
<div class="line">    &quot;interval_seconds&quot;: 60,</div>
<div class="line">    &quot;conflict_policy&quot;: &quot;timestamp&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md112"></a>
üìå Sync Customization</h1>
<ul>
<li>Hook into sync lifecycle via middleware or plugin interface.</li>
<li>Add table-level filters (e.g., sync only "active" records).</li>
<li>Implement custom conflict resolvers per table.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md114"></a>
üèÅ Summary</h1>
<p>Mantis provides a robust but flexible sync system tailored for offline-capable and distributed applications. With per-table tracking, pluggable conflict resolution, and secure transport, it supports both embedded clients and production server sync strategies. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
